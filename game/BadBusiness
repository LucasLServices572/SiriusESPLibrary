local client = game.Players.LocalPlayer
local camera = workspace.CurrentCamera
local mouse = client:GetMouse()
local players = game:GetService("Players")
local rs = game:GetService("RunService") 
local uis = game:GetService("UserInputService")
local ts = require(game:GetService("ReplicatedStorage").TS)
local timer = ts.Timer 
local control = getupvalue(timer.BindToHeartbeat,1)['Control']

local visList = {}
local playerList = {}--[==[{setmetatable({}, {
    __newindex = function(t, k, v)
        rawset(t, k, v)
        visList[k] = {v,false} 
    end
})}]==]

for i,v in ipairs(workspace.Characters:GetChildren()) do 
    playerList[ts.Characters:GetPlayerFromCharacter(v).Name] = v
end
workspace.Characters.ChildAdded:connect(function(v)
    playerList[v.Name] = v
end)
workspace.Characters.ChildRemoved:connect(function(v)
    playerList[ts.Characters:GetPlayerFromCharacter(v).Name] = nil
end)
players.PlayerRemoving:connect(function(v) playerList[v.Name] = nil end)



local gun
if playerList[client.Name] then 
    for i,v in ipairs(workspace:GetChildren()) do 
        if v:FindFirstChild("Root") then 
            if (v.Root.Position - playerList[client.Name].Root.Position).magnitude < 2 then 
                gun = v
            end
        end
    end
end
workspace.ChildAdded:connect(function(v)
    if playerList[client.Name] and v:FindFirstChild("Root") then 
        if (v.Root.Position - playerList[client.Name].Root.Position).magnitude < 2 then 
            gun = v
        end
    end
end)
local function zigzag(X) return math.acos(math.cos(X*math.pi))/math.pi end
local colorCounter = 0 
local function isFriend(player)
    local teams = ts.Teams:GetTeams()
    local cT = nil 
    local pT = nil
    for _,team in pairs(teams) do 
        for i,v in pairs(ts.Teams:GetTeamPlayers(team)) do 
            if v == client then cT = team end
            if v == player then pT = team end
        end
    end
    if cT == pT then return true, pT else return false, pT end
end

--[==[Drawing Functions]==]--
local function newCircle()
    local x = Drawing.new("Circle")
    x.Radius = 50
    x.Visible = false 
    x.Color = Color3.fromRGB(255,255,255)
    x.Thickness = 2 
    x.Position = Vector2.new(0,0)    
    return x
end
local function newLine()
    local x = Drawing.new("Line")
    x.Visible = false 
    x.From = Vector2.new(0,0)
    x.To = Vector2.new(0,1)
    x.Thickness = 2 
    x.Color = Color3.fromRGB(255,255,255)
    return x 
end
local function newText()
    local x = Drawing.new("Text")
    x.Visible = false
    x.Font = 1 
    x.Color = Color3.fromRGB(255,255,255)
    x.Center = true
    return x 
end
local function newQuad()
    local x = Drawing.new("Quad")
    x.Visible = false 
    x.PointA = Vector2.new(0,0)
    x.PointB = Vector2.new(0,1)
    x.PointC = Vector2.new(1,1)
    x.PointD = Vector2.new(1,0)
    x.Thickness = 2 
    x.Color = Color3.fromRGB(255,255,255)
    return x 
end
local function setLine(x,y,z)
    x.From = Vector2.new(y.X,y.Y)
    x.To = Vector2.new(z.X,z.Y)
end
local function setQuad(x,a,b,c,d)
    x.PointA = Vector2.new(a.X,a.Y)
    x.PointB = Vector2.new(b.X,b.Y)
    x.PointC = Vector2.new(c.X,c.Y)
    x.PointD = Vector2.new(d.X,d.Y)
end


local aimbotSettings = { 
    enabled = true,
    smoothness = 2,
    fov = 50,
    tc = true,
    fovObj = newCircle(),
    visCheck = false,
    isAiming = false ,
    hitPart = "Head"
}
local silentSettings = {
    enabled = false,
    fov = 50,
    fovObj = newCircle(),
    tc = true,
    wallCheck = false,
    headshotChance = 100
}
local cameraSettings = {
    fovEnabled = false,
    fov = 70
}
local modSettings = {
    noSpread = false,
    rapidFire = false,
    noRecoil = false
}
local characterSettings = {
    rArms = false,
    rGun = false
}
local flySettings = {
    enabled = false,
    canFly = false,
    speed = 120,
    key = "F",
    keys = {w,a,s,d,up,down}
}
local espSettings = {
    rainbow = false,
    rainbowFill = false
}

local function updateVisible()
    visList = {}
    for i,v in ipairs(players:GetPlayers()) do 
        local character = playerList[v.Name]
        local me = playerList[client.Name]
        if v ~= client and character and character.Body:FindFirstChild(aimbotSettings.hitPart) then 
            local params = RaycastParams.new()
        	params.FilterDescendantsInstances = {me or nil,camera,me}
        	params.FilterType = Enum.RaycastFilterType.Blacklist
        	local raycastResult = workspace:Raycast(camera.CFrame.p, (character.Body[aimbotSettings.hitPart].Position-camera.CFrame.p).Unit*9e9, params)
        	if raycastResult then 
        	    local part = raycastResult.Instance
        	    if part:IsDescendantOf(character) then 
                    table.insert(visList,v)
        	    end
        	end
        end
    end
end

--[==[Aimbot]==]--
local function getHitboxPart(character,givenPart)
    local closest = math.huge
    local part = nil
    local bodyPart = character.Body:FindFirstChild(givenPart)
    if bodyPart then 
        for i,v in ipairs(character.Hitbox:GetChildren()) do 
            if (v.Position - bodyPart.Position).magnitude < closest then 
                part = v 
                closest = (v.Position - bodyPart.Position).magnitude
            end
        end
    end
    return part
end
local function closestPlayer(fov,tc,ai)
    local target = nil
    local closest = fov or math.huge
    local hit = "Chest"
    if ai then hit = aimbotSettings.hitPart else 
        local randHit = math.random(1,100)
        if silentSettings.headshotChance >= randHit then 
            hit = "Head"    
        end
    end
    for i, v in ipairs(players:GetPlayers()) do 
        local character = playerList[v.Name]
        local onTeam = false 
        if tc then onTeam = isFriend(v) end 
        if not onTeam and character and character.Body:FindFirstChild(hit) then 
            local _, onscreen = camera:WorldToScreenPoint(character.Body[hit].Position)
            if onscreen then 
                local mousePos = camera:WorldToViewportPoint(mouse.Hit.p)
                local targetPos = camera:WorldToViewportPoint(character.Body[hit].Position)
                local dist = (Vector2.new(mousePos.X, mousePos.Y) - Vector2.new(targetPos.X, targetPos.Y)).magnitude
                if dist < closest then 
                    closest = dist 
                    target = v 
                end
            end
        end
    end
    return target, hit
end

local function aimAt(pos,smooth)
    local targetPos = camera:WorldToScreenPoint(pos)
    local mousePos = camera:WorldToScreenPoint(mouse.Hit.p)
    mousemoverel((targetPos.X-mousePos.X)/smooth,(targetPos.Y-mousePos.Y)/smooth)
end

--[==[Esp]==]--

local espSettings ={
    teamColor = Color3.fromRGB(0,0,255),
    enemyColor = Color3.fromRGB(255,0,0)
}

local espLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/shlexware/Sirius/request/library/esp/esp.lua'),true))()
espLib.options.boxes = false
espLib.options.boxFill = false
espLib.options.outOfViewArrows = false
espLib.options.outOfViewArrowsOutline = false
espLib.options.names = false
espLib.options.healthBars = false
espLib.options.healthText = false
espLib.options.distance = false
espLib.options.chams = false
espLib.options.tracers = false
espLib.options.scaleFactorY = 8 
espLib.options.scaleFactorX = 2 
espLib.options.offsetY = -2 
function espLib.GetCharacter(player) 
    local character = playerList[player.Name]
    return character, character and game.FindFirstChild(character, "Root") 
end
function espLib.GetHealth(player, character) 
    local health = game.FindFirstChild(character, "Health") 
    if (health) then 
        return health.Value,health.MaxHealth.Value
    end
    return 100, 100 
end
local isFFA = false 
function espLib.GetTeam(player)
    if isFFA then 
        if player == client then 
            return 1, Color3.fromRGB(255,255,255)
        else 
            return 2, espSettings.enemyColor
        end 
    end
    local x, team = isFriend(player)
    teamColor = espSettings.enemyColor
    if x then teamColor = espSettings.teamColor end
    return team, teamColor 
end




--[==[Hooking]==]--
a=(function()
local oldName 
oldName = hookmetamethod(game,"__namecall",function(self,...)
    local args = {...}
    local method = getnamecallmethod()
    if silentSettings.enabled and tostring(self) == "Projectiles" and tostring(method) == "FireServer" then
        local t, t2 = closestPlayer(silentSettings.fov,silentSettings.tc) 
        if t then 
            local isVis = true
            if silentSettings.wallCheck then 
                isVis = false 
                for i,v in pairs(visList) do 
                    if v == t then 
                        isVis = true 
                    end 
                end 
            end
            if isVis then
                local part = getHitboxPart(playerList[t.Name],t2)
                args[3] = part.Position 
                args[4] = part
            end
        end
        return self.FireServer(self, unpack(args))
    end
    return oldName(self,...)
end)
local newInd
newInd = hookmetamethod(game, "__newindex", function(self, index,value)
    if not checkcaller() and cameraSettings.fovEnabled and self == camera and index == "FieldOfView" then 
        return newInd(self, index, cameraSettings.fov)  
    end 
    return newInd(self, index, value) 
end)
randHook = hookfunction(getrenv().math.random,function(...)
    local args = {...}
    if tostring(getfenv(2).script) == 'ItemControlScript' and modSettings.noSpread then
        if math.abs(args[1]) == args[2] then
            args[1] = -0.1
            args[2] = 0.1
            return randHook(unpack(args))
        end
    end
    return randHook(...)
end)
updateHook = hookfunction(ts.Camera.Recoil.Update,function(p6, p7)
    if modSettings.noRecoil then
        return p6.Value - p6.LastValue;
    end
    return updateHook(p6,p7)
end)
oldWait = hookfunction(ts.Timer.Wait,function(...)
    local args = {...}
    if tostring(getcallingscript()) == 'ItemControlScript' then
        args[2] = 0.01
    end
    return oldWait(unpack(args))
end)
end)()
--[==[Key Inputs]==]--
uis.InputBegan:Connect(function(input, gameProcessed)
	if input.UserInputType == Enum.UserInputType.MouseButton2 then 
	    aimbotSettings.isAiming = true
	elseif input.KeyCode.Name == "W" then flySettings.keys.w = true 
	elseif input.KeyCode.Name == "S" then flySettings.keys.s = true 
	elseif input.KeyCode.Name == "A" then flySettings.keys.a = true 
	elseif input.KeyCode.Name == "D" then flySettings.keys.d = true 
	elseif input.KeyCode.Name == "Space" then flySettings.keys.up = true 
	elseif input.KeyCode.Name == "LeftShift" then flySettings.keys.down = true 
	end
end)
uis.InputEnded:Connect(function(input, gameProcessed)
	if input.UserInputType == Enum.UserInputType.MouseButton2 then 
	    aimbotSettings.isAiming = false
	elseif input.KeyCode.Name == "W" then flySettings.keys.w = false 
	elseif input.KeyCode.Name == "S" then flySettings.keys.s = false 
	elseif input.KeyCode.Name == "A" then flySettings.keys.a = false 
	elseif input.KeyCode.Name == "D" then flySettings.keys.d = false 
	elseif input.KeyCode.Name == "Space" then flySettings.keys.up = false 
	elseif input.KeyCode.Name == "LeftShift" then flySettings.keys.down = false 
	end 
end)


rs.RenderStepped:connect(function()
    updateVisible()
    local character = playerList[client.Name]
    local arms = workspace:FindFirstChild("Arms")
    colorCounter = colorCounter + 0.002
    local rColor = Color3.fromHSV(zigzag(colorCounter),1,1)
    if espSettings.rainbow then 
        espLib.options.boxesColor = rColor
    end
    if espSettings.rainbowFill then 
        espLib.options.boxFillColor = rColor 
    end 
    if arms then 
        if characterSettings.rArms then 
            for i,v in ipairs(arms:GetDescendants()) do 
                if v:IsA("Part") or v:IsA("MeshPart") then 
                    v.Color = rColor
                end
            end
        end
        if gun and characterSettings.rGun then 
            for i,v in ipairs(gun:GetDescendants()) do 
                if v:IsA("Part") or v:IsA("MeshPart") then 
                    v.Color = rColor
                end
            end
        end
    end
    if flySettings.enabled and character and character:FindFirstChild("Root") then
        local newVel = Vector3.new(0,0,0)
        local newCF = CFrame.new(0,0,0)
        if flySettings.keys.w then 
            newCF = newCF * CFrame.new(0,0,-flySettings.speed)   
        end
        if flySettings.keys.s then 
            newCF = newCF * CFrame.new(0,0,flySettings.speed)
        end
        if flySettings.keys.d then 
            newCF = newCF * CFrame.new(flySettings.speed,0,0)
        end
        if flySettings.keys.a then 
            newCF = newCF * CFrame.new(-flySettings.speed,0,0)
        end
        if flySettings.keys.up then 
            newCF = newCF * CFrame.new(0,flySettings.speed,0)
        end
        if flySettings.keys.down then 
            newCF = newCF * CFrame.new(0,-flySettings.speed,0)
        end
        if newCF ~= CFrame.new(0,0,0) then newVel = ((character.Root.CFrame * newCF).p-character.Root.Position) character.Root.Anchored = false else character.Root.Anchored = true end 
        character.Root.Velocity = newVel
    end
    if aimbotSettings.enabled and aimbotSettings.isAiming then 
        local t, t2 = closestPlayer(aimbotSettings.fov,aimbotSettings.tc,true) 
        if t then
            aimAt(playerList[t.Name].Body[t2].Position,aimbotSettings.smoothness)
        end
    end
    local mousePos = camera:WorldToViewportPoint(mouse.Hit.p)
    silentSettings.fovObj.Position = Vector2.new(mousePos.X, mousePos.Y)
    aimbotSettings.fovObj.Position = Vector2.new(mousePos.X, mousePos.Y)
end)

local lib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/shlexware/Orion/main/source')))()
local win = lib:MakeWindow({Name = "Bad Business", HidePremium = false, SaveConfig = true, ConfigFolder = "BadBusiness"})
local combatTab = win:MakeTab({Name = "Combat", Icon = "rbxassetid://4483345998", PremiumOnly = false})
local aimbotSec = combatTab:AddSection({Name = "Aimbot"})
aimbotSec:AddToggle({Name = "Enabled",Default = false,Callback = function(x)aimbotSettings.enabled=x end,Save = true, Flag = "AIMBOTENABLED"})
aimbotSec:AddToggle({Name = "Team Check",Default = false,Callback = function(x)aimbotSettings.tc=x end,Save = true, Flag = "AIMBOTTC"})
aimbotSec:AddSlider({Name = "Smoothness",Min = 2,Max = 20,Default = 2,Color = Color3.fromRGB(0,0,200),Increment = 1,ValueName = "",Callback = function(x)aimbotSettings.smoothness=x end,Save = true, Flag = "AIMBOTSMOOTHNESS"})
aimbotSec:AddDropdown({Name = "Hit Part",Default = "Head",Options = {"Head", "Chest"},Callback = function(x)aimbotSettings.hitPart=x end, Save = true, Flag = "HITPART"})
aimbotSec:AddToggle({Name = "Show Fov",Default = false,Callback = function(x)aimbotSettings.fovObj.Visible=x end,Save = true, Flag = "AIMBOTSHOWFOV"})
aimbotSec:AddSlider({Name = "Fov",Min = 50,Max = 1000,Default = 50,Color = Color3.fromRGB(0,0,200),Increment = 1,ValueName = "",Callback = function(x)aimbotSettings.fovObj.Radius=x aimbotSettings.fov=x end,Save = true, Flag = "AIMBOTFOV"})
aimbotSec:AddColorpicker({Name = "Fov Color",Default = Color3.fromRGB(255, 255, 255),Callback = function(x)aimbotSettings.fovObj.Color=x end,Save = true, Flag = "AIMBOTFOVCOLOR"})
local silentSec = combatTab:AddSection({Name = "Silent Aim"})
silentSec:AddToggle({Name = "Enabled",Default = false,Callback = function(x)silentSettings.enabled=x end,Save = true, Flag = "SILENTENABLED"})
silentSec:AddToggle({Name = "Team Check",Default = false,Callback = function(x)silentSettings.tc=x end,Save = true, Flag = "SILENTTC"})
silentSec:AddSlider({Name = "Headshot Chance",Min = 0,Max = 100,Default = 100,Color = Color3.fromRGB(0,0,200),Increment = 1,ValueName = "",Callback = function(x)silentSettings.headshotChance=x end,Save = true, Flag = "SILENTCHANCE"})
silentSec:AddToggle({Name = "Wall Check",Default = false,Callback = function(x)silentSettings.wallCheck=x end,Save = true, Flag = "WALLCHECKSILENT"})
silentSec:AddToggle({Name = "Show Fov",Default = false,Callback = function(x)silentSettings.fovObj.Visible=x end,Save = true, Flag = "SILENTSHOWFOV"})
silentSec:AddSlider({Name = "Fov",Min = 50,Max = 1000,Default = 50,Color = Color3.fromRGB(0,0,200),Increment = 1,ValueName = "",Callback = function(x)silentSettings.fovObj.Radius=x silentSettings.fov=x end,Save = true, Flag = "SILENTFOV"})
silentSec:AddColorpicker({Name = "Fov Color",Default = Color3.fromRGB(255, 255, 255),Callback = function(x)silentSettings.fovObj.Color=x end,Save = true, Flag = "SILENTFOVCOLOR"})
--Visuals 
local visualTab = win:MakeTab({Name = "Visuals", Icon = "rbxassetid://6523858394", PremiumOnly = false})
local espSec = visualTab:AddSection({Name = "ESP"})
espSec:AddToggle({Name = "Hide Team",Default = false,Callback = function(x)espLib.options.teamCheck= x end,Save = true, Flag = "HIDETEAM"})
espSec:AddToggle({Name = "FFA",Default = false,Callback = function(x)isFFA= x end,Save = true, Flag = "ISFFAESP"})
espSec:AddToggle({Name = "Boxes",Default = false,Callback = function(x)espLib.options.boxes=x end,Save = true, Flag = "BOXES"})
espSec:AddColorpicker({Name = "Box Color",Default = Color3.fromRGB(255, 255, 255),Callback = function(x)espLib.options.boxesColor =x end,Save = true, Flag = "BOXCOLOR"}) 
espSec:AddToggle({Name = "Team Colors",Default = false,Callback = function(x)espLib.options.teamColor=x end,Save = true, Flag = "TCOLORS"})
espSec:AddToggle({Name = "Rainbow Color",Default = false,Callback = function(x)espSettings.rainbow=x end,Save = true, Flag = "RBOX"})
espSec:AddToggle({Name = "Health Bars",Default = false,Callback = function(x)espLib.options.healthBars=x end,Save = true, Flag = "HEALTHBARS"})
espSec:AddToggle({Name = "Names",Default = false,Callback = function(x)espLib.options.names=x end,Save = true, Flag = "NAMES"})
espSec:AddToggle({Name = "Distance",Default = false,Callback = function(x)espLib.options.distance=x end,Save = true, Flag = "DISTANCE"})
--Client 
local clientTab = win:MakeTab({Name = "Client", Icon = "rbxassetid://1188759634", PremiumOnly = false})
local characterSec = clientTab:AddSection({Name = "Character"})
characterSec:AddToggle({Name = "Rainbow Arms",Default = false,Callback = function(x)characterSettings.rArms=x end,Save = true, Flag = "RAINBOWARMS"})
characterSec:AddToggle({Name = "Rainbow Gun",Default = false,Callback = function(x)characterSettings.rGun=x end,Save = true, Flag = "RAINBOWGUN"})
local moveSec = clientTab:AddSection({Name = "Movement"})
moveSec:AddSlider({Name = "Sprint Multiplier",Min = 1.8,Max = 8,Default = 1.8,Color = Color3.fromRGB(0,0,200),Increment = 0.1,ValueName = "",Callback = function(x)setconstant(control,tonumber(table.find(getconstants(control),'Stand'))+1,x) end,Save = true, Flag = "SPRINTSPEED"})
moveSec:AddToggle({Name = "Fly",Default = false,Callback = function(x)flySettings.canFly=x if not x then flySettings.enabled = false local character = playerList[client.Name] if character and character:FindFirstChild("Root") then character.Root.Anchored = false character.Root.Velocity = Vector3.new(0,0,0) end end end,Save = true, Flag = "CANFLY"})
moveSec:AddBind({Name = "Fly Key",Default = Enum.KeyCode.F,Hold = false,Callback = function()if flySettings.canFly then flySettings.enabled = not flySettings.enabled  local character = playerList[client.Name] if character and character:FindFirstChild("Root") then character.Root.Anchored = false character.Root.Velocity = Vector3.new(0,0,0) end end end, Save = true, Flag = "FLYKEY"})
moveSec:AddSlider({Name = "Fly Speed",Min = 50,Max = 150,Default = 50,Color = Color3.fromRGB(0,0,200),Increment = 1,ValueName = "",Callback = function(x)flySettings.speed=x end,Save = true, Flag = "FLYSPEED"})
local camSec = clientTab:AddSection({Name = "Camera"})
camSec:AddToggle({Name = "Force Fov",Default = false,Callback = function(x)cameraSettings.fovEnabled=x end,Save = true, Flag = "FORCEFOV"})
camSec:AddSlider({Name = "Camera Fov",Min = 90,Max = 120,Default = 70,Color = Color3.fromRGB(0,0,200),Increment = 1,ValueName = "",Callback = function(x)cameraSettings.fov=x end,Save = true, Flag = "CAMERAFOV"})
local miscTab = win:MakeTab({Name = "Misc",Icon = "http://www.roblox.com/asset/?id=484211948",PremiumOnly = false})
local modSec = miscTab:AddSection({Name = "Gun Mods"})
modSec:AddToggle({Name = "No Spread",Default = false,Callback = function(x)modSettings.noSpread = x end,Save = true, Flag = "NOSPREAD"})
modSec:AddToggle({Name = "No Recoil",Default = false,Callback = function(x)modSettings.noRecoil = x end,Save = true, Flag = "NORECOIL"})
modSec:AddToggle({Name = "Rapid Fire",Default = false,Callback = function(x)modSettings.rapidFire = x end,Save = true, Flag = "RAPIDFIRE"})
espLib.Init()
lib:Init()

